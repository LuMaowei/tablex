{"remainingRequest":"/home/nexx/develop/tablex/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/nexx/develop/tablex/node_modules/docz-core/node_modules/babel-loader/lib/index.js??ref--5-2!/home/nexx/develop/tablex/node_modules/source-map-loader/index.js!/home/nexx/develop/tablex/src/index.js","dependencies":[{"path":"/home/nexx/develop/tablex/src/index.js","mtime":1555838147685},{"path":"/home/nexx/develop/tablex/node_modules/cache-loader/dist/cjs.js","mtime":1555737869369},{"path":"/home/nexx/develop/tablex/node_modules/thread-loader/dist/cjs.js","mtime":1555737872026},{"path":"/home/nexx/develop/tablex/node_modules/docz-core/node_modules/babel-loader/lib/index.js","mtime":1555737864633},{"path":"/home/nexx/develop/tablex/node_modules/source-map-loader/index.js","mtime":1555737871137}],"contextDependencies":[],"result":["import _toConsumableArray from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import TableBody from\"./components/body\";import TableHead from\"./components/head\";import\"./index.css\";import{treeToList,getDataListWithExpanded}from\"./tree-data-utils\";import LoadingMsg from\"./components/loading\";var Table=/*#__PURE__*/function(_React$Component){_inherits(Table,_React$Component);function Table(){var _getPrototypeOf2;var _this;_classCallCheck(this,Table);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Table)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={rowKey:undefined,columns:[],columnLeafs:[],dataSource:[],dataList:[],expandedKeys:[],loadingKeys:[]};_this.onBodyScroll=function(_ref){var scrollLeft=_ref.scrollLeft;var head=_this.refs[\"head\"];head.scrollTo(scrollLeft,0);};_this.onExpandChange=function(isExpand,key){isExpand===true?_this.collapse(key):_this.expand(key);};_this.expand=function(key){var expandedKeys=_this.state.expandedKeys;var nextExpandedKeys=_toConsumableArray(expandedKeys);var i=expandedKeys.indexOf(key);if(i===-1){nextExpandedKeys.push(key);}_this.setState({expandedKeys:nextExpandedKeys});if(typeof _this.props.loadChildrenData===\"function\"){_this.loadChildrenData(key);}};_this.collapse=function(key){var expandedKeys=_this.state.expandedKeys;var nextExpandedKeys=_toConsumableArray(expandedKeys);var i=expandedKeys.indexOf(key);if(i>-1){nextExpandedKeys.splice(i,1);}_this.setState({expandedKeys:nextExpandedKeys});};_this.setLoadingChildren=function(key,bl,callback){var loadingKeys=_this.state.loadingKeys;var i=loadingKeys.indexOf(key);var nextKeys=_toConsumableArray(loadingKeys);if(bl===true){if(i===-1){nextKeys.push(key);}}else{if(i>-1){nextKeys.splice(i,1);}}return _this.setState({loadingKeys:nextKeys},callback);};_this.loadChildrenData=function(key){var _this$state=_this.state,dataList=_this$state.dataList,rowKey=_this$state.rowKey;var row=dataList.find(function(d){return d[rowKey]===key;});var res=_this.props.loadChildrenData(row);if(res&&res.constructor.name===\"Promise\"){_this.setLoadingChildren(key,true);res.then(function(childrens){if(childrens){row.children=childrens;}_this.setLoadingChildren(key,false);});res.catch(function(e){_this.setLoadingChildren(key,false);});}};return _this;}_createClass(Table,[{key:\"render\",value:function render(){var _this$state2=this.state,columns=_this$state2.columns,columnLeafs=_this$state2.columnLeafs,dataList=_this$state2.dataList,rowKey=_this$state2.rowKey,expandedKeys=_this$state2.expandedKeys,loadingKeys=_this$state2.loadingKeys,loading=_this$state2.loading;return React.createElement(\"div\",{className:\"tablex\"},React.createElement(\"div\",{className:\"tablex-head\",ref:\"head\"},React.createElement(TableHead,{columns:columns,columnLeafs:columnLeafs})),React.createElement(\"div\",{className:\"tablex-body\"},React.createElement(TableBody,{rowKey:rowKey,columns:columns,columnLeafs:columnLeafs,dataSource:dataList,onScroll:this.onBodyScroll,onExpandChange:this.onExpandChange,expandedKeys:expandedKeys,loadingKeys:loadingKeys}),loading===true?React.createElement(LoadingMsg,null):null));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps,prevState){var expandedKeys=prevState.expandedKeys;var rowKey=nextProps.rowKey,columns=nextProps.columns,dataSource=nextProps.dataSource,loading=nextProps.loading;var _treeToList=treeToList(columns),columnLeafs=_treeToList.leafs;var dataList=dataSource;if(expandedKeys.length>0){dataList=getDataListWithExpanded(dataSource,expandedKeys,rowKey);}var nextState={rowKey:rowKey,columns:columns,dataSource:dataSource,columnLeafs:columnLeafs,dataList:dataList,loading:!!loading};return nextState;}/**\n   * @isExpand 是否展开\n   * @key 受影响的行数据key\n   */}]);return Table;}(React.Component);Table.defaultProps={columns:[],dataSource:[],loading:false};export default Table;if(typeof Table!=='undefined'&&Table&&Table===Object(Table)&&Object.isExtensible(Table)){Object.defineProperty(Table,'__filemeta',{enumerable:true,configurable:true,value:{name:\"Table\",filename:\"src/index.js\"}});}",{"version":3,"sources":["/home/nexx/develop/tablex/src/index.js"],"names":["React","TableBody","TableHead","treeToList","getDataListWithExpanded","LoadingMsg","Table","state","rowKey","undefined","columns","columnLeafs","dataSource","dataList","expandedKeys","loadingKeys","onBodyScroll","scrollLeft","head","refs","scrollTo","onExpandChange","isExpand","key","collapse","expand","nextExpandedKeys","i","indexOf","push","setState","props","loadChildrenData","splice","setLoadingChildren","bl","callback","nextKeys","row","find","d","res","constructor","name","then","childrens","children","catch","e","loading","nextProps","prevState","leafs","length","nextState","Component","defaultProps"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport TableBody from \"./components/body\";\nimport TableHead from \"./components/head\";\nimport \"./index.css\";\nimport { treeToList, getDataListWithExpanded } from \"./tree-data-utils\";\n\nimport LoadingMsg from \"./components/loading\";\n\nclass Table extends React.Component {\n  state = {\n    rowKey: undefined,\n    columns: [],\n    columnLeafs: [],\n    dataSource: [],\n    dataList: [],\n\n    expandedKeys: [],\n    loadingKeys: []\n  };\n\n  onBodyScroll = ({ scrollLeft }) => {\n    let head = this.refs[\"head\"];\n    head.scrollTo(scrollLeft, 0);\n  };\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    let { expandedKeys } = prevState;\n\n    let { rowKey, columns, dataSource, loading } = nextProps;\n\n    let { leafs: columnLeafs } = treeToList(columns);\n\n    let dataList = dataSource;\n\n    if (expandedKeys.length > 0) {\n      dataList = getDataListWithExpanded(dataSource, expandedKeys, rowKey);\n    }\n\n    let nextState = {\n      rowKey,\n      columns,\n      dataSource,\n      columnLeafs,\n      dataList,\n      loading: !!loading\n    };\n\n    return nextState;\n  }\n\n  /**\n   * @isExpand 是否展开\n   * @key 受影响的行数据key\n   */\n  onExpandChange = (isExpand, key) => {\n    isExpand === true ? this.collapse(key) : this.expand(key);\n  };\n\n  /**\n   * 展开\n   */\n  expand = key => {\n    let { expandedKeys } = this.state;\n\n    let nextExpandedKeys = [...expandedKeys];\n\n    let i = expandedKeys.indexOf(key);\n\n    if (i === -1) {\n      nextExpandedKeys.push(key);\n    }\n\n    this.setState({\n      expandedKeys: nextExpandedKeys\n    });\n\n    if (typeof this.props.loadChildrenData === \"function\") {\n      this.loadChildrenData(key);\n    }\n  };\n\n  /**\n   * 折叠\n   */\n  collapse = key => {\n    let { expandedKeys } = this.state;\n\n    let nextExpandedKeys = [...expandedKeys];\n\n    let i = expandedKeys.indexOf(key);\n\n    if (i > -1) {\n      nextExpandedKeys.splice(i, 1);\n    }\n\n    this.setState({\n      expandedKeys: nextExpandedKeys\n    });\n  };\n\n  /**\n   * 设置行的子级加载状态\n   */\n  setLoadingChildren = (key, bl, callback) => {\n    let { loadingKeys } = this.state;\n\n    let i = loadingKeys.indexOf(key);\n\n    let nextKeys = [...loadingKeys];\n\n    if (bl === true) {\n      if (i === -1) {\n        nextKeys.push(key);\n      }\n    } else {\n      if (i > -1) {\n        nextKeys.splice(i, 1);\n      }\n    }\n\n    return this.setState({ loadingKeys: nextKeys }, callback);\n  };\n\n  /**\n   * 异步加载子级数据\n   */\n  loadChildrenData = key => {\n    let { dataList, rowKey } = this.state;\n\n    let row = dataList.find(d => d[rowKey] === key);\n\n    let res = this.props.loadChildrenData(row);\n\n    if (res && res.constructor.name === \"Promise\") {\n      this.setLoadingChildren(key, true);\n\n      res.then(childrens => {\n        if (childrens) {\n          row.children = childrens;\n        }\n\n        this.setLoadingChildren(key, false);\n      });\n\n      res.catch(e => {\n        this.setLoadingChildren(key, false);\n      });\n    }\n  };\n\n  render() {\n    let {\n      columns,\n      columnLeafs,\n      dataList,\n      rowKey,\n      expandedKeys,\n      loadingKeys,\n      loading\n    } = this.state;\n\n    return (\n      <div className=\"tablex\">\n        <div className=\"tablex-head\" ref=\"head\">\n          <TableHead columns={columns} columnLeafs={columnLeafs} />\n        </div>\n\n        <div className=\"tablex-body\">\n          <TableBody\n            rowKey={rowKey}\n            columns={columns}\n            columnLeafs={columnLeafs}\n            dataSource={dataList}\n            onScroll={this.onBodyScroll}\n            onExpandChange={this.onExpandChange}\n            expandedKeys={expandedKeys}\n            loadingKeys={loadingKeys}\n          />\n          {loading === true ? <LoadingMsg /> : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nTable.defaultProps = {\n  columns: [],\n  dataSource: [],\n  loading: false\n};\n\nTable.propTypes = {\n  /**\n   * 表格列\n   *\n   */\n  columns: PropTypes.array.isRequired,\n\n  /**\n   * 表格数据\n   */\n  dataSource: PropTypes.array.isRequired,\n  /** 数据行主键字段\n   * 主要用于行展开\n   */\n  rowKey: PropTypes.string.isRequired,\n  /** 行展开变化事件\n   * @expandedRows 展开的行\n   */\n  onExpandedRowsChange: PropTypes.func,\n  rowIndent: PropTypes.number,\n  expandedKeys: PropTypes.array,\n  loadChildrenData: PropTypes.func,\n  loading: PropTypes.bool\n};\n\nexport default Table;\n"]}]}