{"remainingRequest":"/home/nexx/develop/tablex/node_modules/thread-loader/dist/cjs.js??ref--5-1!/home/nexx/develop/tablex/node_modules/babel-loader/lib/index.js??ref--5-2!/home/nexx/develop/tablex/node_modules/source-map-loader/index.js!/home/nexx/develop/tablex/src/index.js","dependencies":[{"path":"/home/nexx/develop/tablex/src/index.js","mtime":1556759207734},{"path":"/home/nexx/develop/tablex/node_modules/cache-loader/dist/cjs.js","mtime":1555838893487},{"path":"/home/nexx/develop/tablex/node_modules/thread-loader/dist/cjs.js","mtime":1555838894922},{"path":"/home/nexx/develop/tablex/node_modules/babel-loader/lib/index.js","mtime":1555838893306},{"path":"/home/nexx/develop/tablex/node_modules/source-map-loader/index.js","mtime":1555838894829}],"contextDependencies":[],"result":["import _toConsumableArray from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/nexx/develop/tablex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import TableBody from\"./base/fixedBody\";import TableHead from\"./base/fixedHead\";import\"./index.css\";import{treeToList,getDataListWithExpanded,getScrollbarWidth}from\"./helper\";import LoadingMsg from\"./components/loading\";import NoDataMsg from\"./components/noDataMsg\";var scrollbarWidth=getScrollbarWidth();var Table=/*#__PURE__*/function(_React$Component){_inherits(Table,_React$Component);function Table(){var _getPrototypeOf2;var _this;_classCallCheck(this,Table);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Table)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={rowKey:undefined,columns:[],columnLeafs:[],dataSource:[],dataList:[],expandedKeys:[],loadingKeys:[]};_this.onExpandChange=function(isExpand,key){isExpand===true?_this.collapse(key):_this.expand(key);};_this.expand=function(key){var expandedKeys=_this.state.expandedKeys;var nextExpandedKeys=_toConsumableArray(expandedKeys);var i=expandedKeys.indexOf(key);if(i===-1){nextExpandedKeys.push(key);}_this.setState({expandedKeys:nextExpandedKeys});if(typeof _this.props.loadChildrenData===\"function\"){_this.loadChildrenData(key);}};_this.collapse=function(key){var expandedKeys=_this.state.expandedKeys;var nextExpandedKeys=_toConsumableArray(expandedKeys);var i=expandedKeys.indexOf(key);if(i>-1){nextExpandedKeys.splice(i,1);}_this.setState({expandedKeys:nextExpandedKeys});};_this.setLoadingChildren=function(key,bl,callback){var loadingKeys=_this.state.loadingKeys;var i=loadingKeys.indexOf(key);var nextKeys=_toConsumableArray(loadingKeys);if(bl===true){if(i===-1){nextKeys.push(key);}}else{if(i>-1){nextKeys.splice(i,1);}}return _this.setState({loadingKeys:nextKeys},callback);};_this.loadChildrenData=function(key){var _this$state=_this.state,dataList=_this$state.dataList,rowKey=_this$state.rowKey;var row=dataList.find(function(d){return d[rowKey]===key;});var res=_this.props.loadChildrenData(row);if(res&&res.constructor.name===\"Promise\"){_this.setLoadingChildren(key,true);res.then(function(childrens){if(childrens){row.children=childrens;}_this.setLoadingChildren(key,false);});res.catch(function(e){_this.setLoadingChildren(key,false);});}};_this.onBodyScroll=function(_ref){var scrollLeft=_ref.scrollLeft;var head=_this.headRef;head&&head.scrollTo({scrollLeft:scrollLeft});};return _this;}_createClass(Table,[{key:\"render\",value:function render(){var _this2=this;var _this$state2=this.state,columns=_this$state2.columns,columnLeafs=_this$state2.columnLeafs,dataList=_this$state2.dataList,rowKey=_this$state2.rowKey,expandedKeys=_this$state2.expandedKeys,loadingKeys=_this$state2.loadingKeys,loading=_this$state2.loading;return React.createElement(\"div\",{className:\"tablex\"},React.createElement(\"div\",{className:\"tablex-head\"},React.createElement(TableHead,{columns:columns,columnLeafs:columnLeafs,initRef:function initRef(ins){return _this2.headRef=ins;}})),React.createElement(\"div\",{className:\"tablex-body\"},React.createElement(TableBody,{rowKey:rowKey,columns:columns,columnLeafs:columnLeafs,dataSource:dataList,onScroll:this.onBodyScroll,onExpandChange:this.onExpandChange,expandedKeys:expandedKeys,loadingKeys:loadingKeys,scrollbarWidth:scrollbarWidth}),dataList.length===0?React.createElement(NoDataMsg,null):null,loading===true?React.createElement(LoadingMsg,null):null));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps,prevState){var expandedKeys=prevState.expandedKeys;var rowKey=nextProps.rowKey,columns=nextProps.columns,dataSource=nextProps.dataSource,loading=nextProps.loading;var _treeToList=treeToList(columns),columnLeafs=_treeToList.leafs;var dataList=dataSource;if(expandedKeys.length>0){dataList=getDataListWithExpanded(dataSource,expandedKeys,rowKey);}var nextState={rowKey:rowKey,columns:columns,dataSource:dataSource,columnLeafs:columnLeafs,dataList:dataList,loading:!!loading};return nextState;}/**\n   * @isExpand 是否展开\n   * @key 受影响的行数据key\n   */}]);return Table;}(React.Component);Table.defaultProps={columns:[],dataSource:[],loading:false};export default Table;if(typeof Table!=='undefined'&&Table&&Table===Object(Table)&&Object.isExtensible(Table)){Object.defineProperty(Table,'__filemeta',{enumerable:true,configurable:true,value:{name:\"Table\",filename:\"src/index.js\"}});}",{"version":3,"sources":["/home/nexx/develop/tablex/src/index.js"],"names":["React","TableBody","TableHead","treeToList","getDataListWithExpanded","getScrollbarWidth","LoadingMsg","NoDataMsg","scrollbarWidth","Table","state","rowKey","undefined","columns","columnLeafs","dataSource","dataList","expandedKeys","loadingKeys","onExpandChange","isExpand","key","collapse","expand","nextExpandedKeys","i","indexOf","push","setState","props","loadChildrenData","splice","setLoadingChildren","bl","callback","nextKeys","row","find","d","res","constructor","name","then","childrens","children","catch","e","onBodyScroll","scrollLeft","head","headRef","scrollTo","loading","ins","length","nextProps","prevState","leafs","nextState","Component","defaultProps"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport TableBody from \"./base/fixedBody\";\nimport TableHead from \"./base/fixedHead\";\nimport \"./index.css\";\nimport {\n  treeToList,\n  getDataListWithExpanded,\n  getScrollbarWidth\n} from \"./helper\";\n\nimport LoadingMsg from \"./components/loading\";\nimport NoDataMsg from \"./components/noDataMsg\";\n\nlet scrollbarWidth = getScrollbarWidth();\n\nclass Table extends React.Component {\n  state = {\n    rowKey: undefined,\n    columns: [],\n    columnLeafs: [],\n    dataSource: [],\n    dataList: [],\n\n    expandedKeys: [],\n    loadingKeys: []\n  };\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    let { expandedKeys } = prevState;\n\n    let { rowKey, columns, dataSource, loading } = nextProps;\n\n    let { leafs: columnLeafs } = treeToList(columns);\n\n    let dataList = dataSource;\n\n    if (expandedKeys.length > 0) {\n      dataList = getDataListWithExpanded(dataSource, expandedKeys, rowKey);\n    }\n\n    let nextState = {\n      rowKey,\n      columns,\n      dataSource,\n      columnLeafs,\n      dataList,\n      loading: !!loading\n    };\n\n    return nextState;\n  }\n\n  /**\n   * @isExpand 是否展开\n   * @key 受影响的行数据key\n   */\n  onExpandChange = (isExpand, key) => {\n    isExpand === true ? this.collapse(key) : this.expand(key);\n  };\n\n  /**\n   * 展开\n   */\n  expand = key => {\n    let { expandedKeys } = this.state;\n\n    let nextExpandedKeys = [...expandedKeys];\n\n    let i = expandedKeys.indexOf(key);\n\n    if (i === -1) {\n      nextExpandedKeys.push(key);\n    }\n\n    this.setState({\n      expandedKeys: nextExpandedKeys\n    });\n\n    if (typeof this.props.loadChildrenData === \"function\") {\n      this.loadChildrenData(key);\n    }\n  };\n\n  /**\n   * 折叠\n   */\n  collapse = key => {\n    let { expandedKeys } = this.state;\n\n    let nextExpandedKeys = [...expandedKeys];\n\n    let i = expandedKeys.indexOf(key);\n\n    if (i > -1) {\n      nextExpandedKeys.splice(i, 1);\n    }\n\n    this.setState({\n      expandedKeys: nextExpandedKeys\n    });\n  };\n\n  /**\n   * 设置行的子级加载状态\n   */\n  setLoadingChildren = (key, bl, callback) => {\n    let { loadingKeys } = this.state;\n\n    let i = loadingKeys.indexOf(key);\n\n    let nextKeys = [...loadingKeys];\n\n    if (bl === true) {\n      if (i === -1) {\n        nextKeys.push(key);\n      }\n    } else {\n      if (i > -1) {\n        nextKeys.splice(i, 1);\n      }\n    }\n\n    return this.setState({ loadingKeys: nextKeys }, callback);\n  };\n\n  /**\n   * 异步加载子级数据\n   */\n  loadChildrenData = key => {\n    let { dataList, rowKey } = this.state;\n\n    let row = dataList.find(d => d[rowKey] === key);\n\n    let res = this.props.loadChildrenData(row);\n\n    if (res && res.constructor.name === \"Promise\") {\n      this.setLoadingChildren(key, true);\n\n      res.then(childrens => {\n        if (childrens) {\n          row.children = childrens;\n        }\n\n        this.setLoadingChildren(key, false);\n      });\n\n      res.catch(e => {\n        this.setLoadingChildren(key, false);\n      });\n    }\n  };\n\n  onBodyScroll = ({ scrollLeft }) => {\n    let head = this.headRef;\n    head && head.scrollTo({ scrollLeft });\n  };\n\n  render() {\n    let {\n      columns,\n      columnLeafs,\n      dataList,\n      rowKey,\n      expandedKeys,\n      loadingKeys,\n      loading\n    } = this.state;\n\n    return (\n      <div className=\"tablex\">\n        <div className=\"tablex-head\" >\n          <TableHead\n            columns={columns}\n            columnLeafs={columnLeafs}\n            initRef={ins => (this.headRef = ins)}\n          />\n        </div>\n\n        <div className=\"tablex-body\">\n          <TableBody\n            rowKey={rowKey}\n            columns={columns}\n            columnLeafs={columnLeafs}\n            dataSource={dataList}\n            onScroll={this.onBodyScroll}\n            onExpandChange={this.onExpandChange}\n            expandedKeys={expandedKeys}\n            loadingKeys={loadingKeys}\n            scrollbarWidth={scrollbarWidth}\n          />\n          {dataList.length === 0 ? <NoDataMsg /> : null}\n          {loading === true ? <LoadingMsg /> : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nTable.defaultProps = {\n  columns: [],\n  dataSource: [],\n  loading: false\n};\n\nTable.propTypes = {\n  /**\n   * 表格列\n   *\n   */\n  columns: PropTypes.array.isRequired,\n\n  /**\n   * 表格数据\n   */\n  dataSource: PropTypes.array.isRequired,\n  /** 数据行主键字段\n   * 主要用于行展开\n   */\n  rowKey: PropTypes.string.isRequired,\n  /** 行展开变化事件\n   * @expandedRows 展开的行\n   */\n  onExpandedRowsChange: PropTypes.func,\n  rowIndent: PropTypes.number,\n  expandedKeys: PropTypes.array,\n  loadChildrenData: PropTypes.func,\n  loading: PropTypes.bool\n};\n\nexport default Table;\n"]}]}