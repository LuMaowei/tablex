---
name: 拖动表格
---

import { Playground, Props } from "docz";
import { flatten, DraggableTable } from "tablex";
import { Input,Icon,Button } from "antd";
import 'antd/dist/antd.css';

# 用法示例

```javascript
import { DraggableTable } from "sy-framework/lib/widget/table";
```

## 只可拖动排序，不可改变层级

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}

onRow(){
  return {
    onClick:function(){
      console.log("onRow:onClick")
    }
  }
}

render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        allowDragLevel={false}
        columns={columns}
        data={data}
        onRow={this.onRow}
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>



## 可改变层级

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}

render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        columns={columns}
        data={data}
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>




## 点击拖拽标识拖动

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}

render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        columns={columns}
        data={data}
        useDragHandle={true}
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>



## 自定义拖拽标识

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}

dragHandleRender(){
  return "D"
}

render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        columns={columns}
        data={data}
        useDragHandle={true}
        dragHandleRender={this.dragHandleRender.bind(this)}
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>





## 使用拖拽标识元素选择器

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100,
        render:function(){
          return <span className="customDragHandle" style={{backgroundColor:"#ccc"}}>drag me</span>
        }
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}


render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        columns={columns}
        data={data}
        dragHandleSelector=".customDragHandle"
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>




## 使用tableRef

> DraggableTable基于原表格封装，调用表格api需要通过tableRef函数获取内部表格实例

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

scrollToItem(result){
if(this.tableRef){
this.tableRef.scrollToItem(15)
}
}


render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        columns={columns}
        data={data}
        tableRef={(ins)=>{
          this.tableRef=ins;
        }}
        header={()=>{
          return <Button onClick={this.scrollToItem.bind(this)}>scroll to</Button>
        }}
      />
    );

}
}

}

</Playground>





## 拖动&编辑

<Playground style={{ height: 400 }}>
 {
  class Demo extends React.Component {
  generateData(columns, count = 20, prefix = "Row") {
    return new Array(count).fill(0).map((row, rowIndex) => {
      return columns.reduce(
        (rowData, column, columnIndex) => {
          if (column.dataIndex !== "id") {
            rowData[column.dataIndex] = Math.floor(Math.random() * 100 + 1);
          } else {
            rowData[column.dataIndex] =
              prefix + " " + rowIndex + " - Col " + columnIndex;
          }

          return rowData;
        },
        {
          id: prefix + rowIndex,
          parentId: null
        }
      );
    });

}

constructor(props) {
super(props);

    const columns = [
      {
        dataIndex: "id",
        title: "id",
        key: "id",
        width: 150
      },
      {
        dataIndex: "column-1",
        key: "column-1",
        title: "column-1",
        width: 100,
        editor:(value, row, index, onchange, ref)=>{
          return <Input ref={ref} defaultValue={value} onChange={(e)=>onchange({"column-1": e.target.value})} />
        }
      },

      {
        dataIndex: "column-2",
        key: "column-2",
        title: "column-2",
        width: 150
      },

      {
        dataIndex: "column-3",
        key: "column-3",
        title: "column-3",
        align: "right"
      },
      {
        dataIndex: "column-4",
        key: "column-4",
        title: "column-4",
        width: 100,
        align: "center"
      }
    ];

    let data = this.generateData(columns, 20);

    this.state = {
      data: data,
      columns: columns
    };

}

onDragComplete(result){
console.log("onDragComplete:",result)
}

  onEditSave(changedRows, newRows, editType) {
    this.setState({ data: newRows });
  }

render() {
let { columns, data } = this.state;

    return (
      <DraggableTable
        rowKey="id"
        editable={true}
        useDragHandle={true}
        onEditSave={this.onEditSave.bind(this)}
        columns={columns}
        data={data}
        onDragComplete={this.onDragComplete.bind(this)}
      />
    );

}
}

}

</Playground>

